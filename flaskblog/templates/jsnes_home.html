{% extends "layout.html" %}

{% block content %}
    <script src="{{ url_for('static', filename='js/jsnes.min.js') }}"></script>

    <!-- ROM loading progress -->
    <div id="loading-container" style="display:none;">
        <p>Loading ROM: <span id="progress-percent">0%</span></p>
        <progress id="progress-bar" max="100" value="0"></progress>
    </div>

    <!-- Canvas container -->
    <div id="canvas-container" class="content-section">
        <canvas id="nes-canvas" width="256" height="240"></canvas>
    </div>

    <div id="emulator-settings" class="content-section">
        <h3>Emulator Settings</h3>

        <!-- Label and ROM loader -->
        <label for="rom-loader">Load ROM:</label>
        <input type="file" id="rom-loader" accept=".nes" />

        <label for="save-load-controls">Savestates:</label>
        <div id="save-load-controls">
            <button id="save-state">Save State</button>
            <button id="load-state">Load State</button>
            <input type="file" id="load-state-file" accept=".json" style="display:none;" />
            <button id="load-state-from-file">Load State from File</button>
            <button id="save-state-to-file">Save State to File</button>
        </div>

        <label for="fps-controls">FPS Controls:</label>
        <div id="fps-controls">
            <button id="increase-fps">Increase FPS</button>
            <button id="decrease-fps">Decrease FPS</button>
            <span>FPS: <span id="fps-display">80</span></span>
        </div>
    </div>
    <!-- Emulator controls -->
    <!-- <div id="controls" class="content-section">
        <h3>Controls</h3>
        
        <button id="start">Start</button>
        <button id="select">Select</button>
        <button id="a">A</button>
        <button id="b">B</button>
        <button id="up">Up</button>
        <button id="down">Down</button>
        <button id="left">Left</button>
        <button id="right">Right</button>
    </div> -->

    <!-- Full Screen button -->
    <!-- <button id="fullscreen">Full Screen</button> -->

    <style>
        #canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: auto; /* Let it resize based on the canvas */
            height: auto; /* Let it resize based on the canvas */
            margin: 0 auto;
        }

        #nes-canvas {
            border: 1px solid black;
            width: 100%; /* Ensure the canvas scales dynamically */
            height: auto; /* Keep the aspect ratio */
        }

        #controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        #controls button {
            padding: 10px;
            font-size: 18px;
            border-radius: 5px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
        }

        #key-guide {
            margin-top: 20px;
        }

        #key-guide ul {
            list-style-type: none;
            padding-left: 0;
        }

        #key-guide ul li {
            margin-bottom: 5px;
        }

        .highlight {
            background-color: rgba(54, 111, 175, 0.315);
            color: rgb(158, 158, 158);
        }

        /* Initially hide the body */
        body {
            visibility: hidden;
        }
        #page-content {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        #canvas-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            width: 100%;
        }

        #sidebar {
            width: 300px; /* Set a fixed width for the sidebar */
            margin-left: 20px;
        }

        #nes-canvas {
            border: 1px solid black;
            width: 100%; /* Ensure the canvas scales dynamically */
            height: auto; /* Keep the aspect ratio */
        }

        #emulator-settings {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        #emulator-settings label {
            margin-right: 10px;
            font-weight: bold;
        }

        #emulator-settings input[type="file"] {
            display: inline-block;
            margin-left: 5px;
        }

        #fps-controls {
            margin-top: 10px;
        }

        label, #rom-loader {
            display: inline-block;
        }

        /* General button style */
        button {
        background-color: #3b4b58; /* Match the dark steel background */
        color: #e0e0e0; /* Light text */
        border: 1px solid #424242; /* Subtle border */
        padding: 10px 20px; /* Padding for a better look */
        font-size: 16px; /* Font size */
        border-radius: 5px; /* Slightly rounded corners */
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition */
        }

        button:hover {
        background-color: #424242; /* Darken slightly on hover */
        color: #ffffff; /* Change to white text on hover */
        }

        button:active {
        background-color: #616161; /* Even darker when clicked */
        color: #ffffff;
        }

        /* Disabled button style */
        button:disabled {
        background-color: #1e1e1e; /* Darker background */
        color: #757575; /* Disabled text */
        cursor: not-allowed;
        }

        input[type="file"] {
        background-color: #3b4b58; /* Similar to buttons */
        color: #e0e0e0;
        border: 1px solid #424242;
        padding: 8px;
        font-size: 14px;
        border-radius: 5px;
        cursor: pointer;
        }

        input[type="file"]:hover {
        background-color: #424242;
        }
    </style>

    <script src="{{ url_for('static', filename='js/nes_player.js') }}" defer></script>
{% endblock %}

{% block sidebar %}
    <h3>Game Button Map</h3>
    <h3>(Click to Remap)</h3>
    <!-- Sidebar content -->
    <group style="margin: 10px; flex: auto;">
        <ul id="button-map">
            <li id="map-start" data-button="start">Start: Enter</li>
            <li id="map-select" data-button="select">Select: C</li>
            <li id="map-a" data-button="a">A: X</li>
            <li id="map-b" data-button="b">B: Z</li>
            <li id="map-up" data-button="up">Up: ArrowUp</li>
            <li id="map-down" data-button="down">Down: ArrowDown</li>
            <li id="map-left" data-button="left">Left: ArrowLeft</li>
            <li id="map-right" data-button="right">Right: ArrowRight</li>
        </ul>
    </group>
{% endblock %}
